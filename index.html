<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Black Hole Relativity Simulator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Three.js and OrbitControls -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <style>
        /* Custom styles for dark theme and fluid canvas */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0d1a; /* Very dark background */
        }
        #scene-container {
            width: 100%;
            height: 50vh; /* Half the viewport height for 3D */
            border-radius: 1rem;
            box-shadow: 0 4px 60px rgba(100, 100, 255, 0.2);
            overflow: hidden;
            background-color: #000000;
        }
        canvas {
            display: block;
        }
        .input-group label {
            font-weight: 500;
            color: #b3b3e6;
        }
        .input-group input {
            background-color: #1a1a33;
            border: 1px solid #333366;
            color: white;
        }
        .result-card {
            background-color: #1a1a33;
            border: 1px solid #333366;
            transition: transform 0.2s;
        }
        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(50, 50, 150, 0.5);
        }
        .section-title {
            color: #a0a0ff;
            text-shadow: 0 0 5px #5050ff;
        }
    </style>
</head>
<body class="p-4 md:p-8 text-white min-h-screen">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-[#7e85ff] section-title mb-2">Black Hole Spacetime Simulator</h1>
            <p class="text-gray-400">Visualize the 3D spacetime distortion and calculate relativistic effects.</p>
        </header>

        <!-- 3D Visualization Area -->
        <div id="scene-container" class="mb-8">
            <!-- Three.js Canvas will be injected here -->
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Input Panel -->
            <div class="bg-[#1a1a33] p-6 rounded-xl shadow-lg lg:col-span-1 h-fit">
                <h2 class="text-2xl font-semibold mb-6 section-title">Parameters</h2>

                <div class="input-group mb-4">
                    <label for="mass" class="block mb-1 text-sm">Black Hole Mass (M in kg):</label>
                    <input type="number" id="mass" value="5e30" class="w-full p-2 rounded-lg" min="1e10" step="1e30">
                    <p class="text-xs text-gray-500 mt-1">e.g., 5e30 (5 followed by 30 zeros)</p>
                </div>

                <div class="input-group mb-6">
                    <label for="distance" class="block mb-1 text-sm">Object Distance (r in meters):</label>
                    <input type="number" id="distance" value="1e10" class="w-full p-2 rounded-lg" min="100000" step="1e9">
                    <p class="text-xs text-gray-500 mt-1">Distance must be greater than R_s</p>
                </div>

                <hr class="border-gray-700 my-4">

                <h3 class="text-lg font-semibold text-[#a0a0ff] mb-4">Reference Inputs</h3>

                <div class="input-group mb-4">
                    <label for="objectMass" class="block mb-1 text-sm">Object Mass (m in kg):</label>
                    <input type="number" id="objectMass" value="70" class="w-full p-2 rounded-lg" min="1" step="1">
                    <p class="text-xs text-gray-500 mt-1">For Gravitational Potential Energy.</p>
                </div>
                
                <div class="input-group mb-4">
                    <label for="referenceTime" class="block mb-1 text-sm">Reference Time (s):</label>
                    <input type="number" id="referenceTime" value="10" class="w-full p-2 rounded-lg" min="1" step="1">
                    <p class="text-xs text-gray-500 mt-1">For Time Dilation calculation.</p>
                </div>

                <div class="input-group mb-6">
                    <label for="referenceLength" class="block mb-1 text-sm">Reference Length (m):</label>
                    <input type="number" id="referenceLength" value="1.8" class="w-full p-2 rounded-lg" min="0.1" step="0.1">
                    <p class="text-xs text-gray-500 mt-1">For Length Compression (e.g., person's height).</p>
                </div>

                <button onclick="runSimulation()"
                        class="w-full bg-[#7e85ff] hover:bg-[#9a9fff] text-black font-bold py-3 rounded-lg transition duration-300 transform hover:scale-[1.02] shadow-xl">
                    Run Calculation & Update 3D
                </button>
            </div>

            <!-- Results Panel (Time & Length) -->
            <div class="bg-[#1a1a33] p-6 rounded-xl shadow-lg lg:col-span-2">
                <h2 class="text-2xl font-semibold mb-6 section-title">Relativistic Effects & Summary</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

                    <div id="rs-card" class="result-card p-4 rounded-lg">
                        <p class="text-sm text-gray-400">Schwarzschild Radius ($r_s$):</p>
                        <p id="rs-result" class="text-xl font-bold text-yellow-400">N/A</p>
                        <p class="text-xs text-gray-500">meters</p>
                    </div>

                    <div id="redshift-card" class="result-card p-4 rounded-lg">
                        <p class="text-sm text-gray-400">Gravitational Redshift ($z$):</p>
                        <p id="redshift-result" class="text-xl font-bold text-orange-400">N/A</p>
                        <p class="text-xs text-gray-500">unitless factor</p>
                    </div>

                    <div id="hover-accel-card" class="result-card p-4 rounded-lg">
                        <p class="text-sm text-gray-400">Hover Acceleration:</p>
                        <p id="hover-accel-result" class="text-xl font-bold text-cyan-400">N/A</p>
                        <p class="text-xs text-gray-500">m/sÂ²</p>
                    </div>

                    <!-- Time Dilation Results -->
                    <div class="col-span-full mt-4">
                        <h3 class="text-lg font-semibold text-[#a0a0ff] mb-2">Time Dilation (Ref. Time = <span id="referenceTime-display">10</span> s)</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div id="faller-time-card" class="result-card p-4 rounded-lg bg-red-900/20">
                                <p class="text-sm text-gray-400">Faller's Time ($t_{faller}$):</p>
                                <p id="faller-time-result" class="text-xl font-bold text-red-300">N/A</p>
                                <p class="text-xs text-gray-500">time experienced by faller</p>
                            </div>
                            <div id="viewer-time-card" class="result-card p-4 rounded-lg bg-green-900/20">
                                <p class="text-sm text-gray-400">Viewer's Time ($t_{viewer}$):</p>
                                <p id="viewer-time-result" class="text-xl font-bold text-green-300">N/A</p>
                                <p class="text-xs text-gray-500">time observed by viewer</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Length Compression Results -->
                    <div class="col-span-full mt-4">
                        <h3 class="text-lg font-semibold text-[#a0a0ff] mb-2">Length Compression (Ref. Length = <span id="referenceLength-display">1.8</span> m)</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div id="faller-length-card" class="result-card p-4 rounded-lg bg-yellow-900/20">
                                <p class="text-sm text-gray-400">Faller's Length ($L_{faller}$):</p>
                                <p id="faller-length-result" class="text-xl font-bold text-yellow-300">N/A</p>
                                <p class="text-xs text-gray-500">length perceived by viewer</p>
                            </div>
                            <div id="viewer-length-card" class="result-card p-4 rounded-lg bg-blue-900/20">
                                <p class="text-sm text-gray-400">Viewer's Length ($L_{viewer}$):</p>
                                <p id="viewer-length-result" class="text-xl font-bold text-blue-300">N/A</p>
                                <p class="text-xs text-gray-500">actual length (at distance)</p>
                            </div>
                        </div>
                    </div>


                    <!-- Other Physics Results -->
                    <div class="col-span-full mt-4">
                        <h3 class="text-lg font-semibold text-[#a0a0ff] mb-2">Dynamics & Energy</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                             <div id="pot-energy-card" class="result-card p-4 rounded-lg">
                                <p class="text-sm text-gray-400">Potential Energy ($U$):</p>
                                <p id="pot-energy-result" class="text-xl font-bold text-lime-400">N/A</p>
                                <p class="text-xs text-gray-500">Joules (J)</p>
                            </div>
                            <div id="escape-vel-card" class="result-card p-4 rounded-lg">
                                <p class="text-sm text-gray-400">Escape Velocity:</p>
                                <p id="escape-vel-result" class="text-xl font-bold text-pink-400">N/A</p>
                                <p class="text-xs text-gray-500">m/s</p>
                            </div>
                            <div id="orbital-vel-card" class="result-card p-4 rounded-lg">
                                <p class="text-sm text-gray-400">Orbital Velocity:</p>
                                <p id="orbital-vel-result" class="text-xl font-bold text-indigo-400">N/A</p>
                                <p class="text-xs text-gray-500">m/s</p>
                            </div>
                            <div id="tidal-force-card" class="result-card p-4 rounded-lg">
                                <p class="text-sm text-gray-400">Tidal Force:</p>
                                <p id="tidal-force-result" class="text-xl font-bold text-purple-400">N/A</p>
                                <p class="text-xs text-gray-500">Newtons (N)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. GLOBAL CONSTANTS AND VARIABLES ---

        // Physical Constants
        const PHYSICS = {
            G: 6.674e-11, // Gravitational Constant (N*m^2/kg^2)
            C: 3.0e8      // Speed of Light (m/s)
        };

        // Three.js Variables
        let scene, camera, renderer, controls;
        let blackHoleMesh, objectMesh, accretionDisk;
        const SCALE_FACTOR = 1e-10; // For mapping huge distances to screen space

        // --- 2. THREE.JS INITIALIZATION ---

        function initThreeJS() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a); // Dark background

            // Camera setup
            const container = document.getElementById('scene-container');
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 50, 100);

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            // Controls (User can rotate/zoom the scene)
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; // smooth rotation
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 1;
            controls.maxDistance = 500;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.1);
            scene.add(ambientLight);
            const pointLight = new THREE.PointLight(0xffffff, 1.0);
            pointLight.position.set(50, 50, 50);
            scene.add(pointLight);

            // Initial Black Hole and Object (will be updated)
            createBlackHole(1);
            createObject(50);

            window.addEventListener('resize', onWindowResize, false);
            animate();
            runSimulation(); // Run initial simulation with default values
        }

        function onWindowResize() {
            const container = document.getElementById('scene-container');
            if (container) {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
        }

        function createBlackHole(radius) {
            // Black Hole (Event Horizon) - Dark sphere
            if (blackHoleMesh) scene.remove(blackHoleMesh);
            const bhGeometry = new THREE.SphereGeometry(radius, 64, 64);
            const bhMaterial = new THREE.MeshPhongMaterial({
                color: 0x000000,
                specular: 0x000000,
                shininess: 0,
                flatShading: false
            });
            blackHoleMesh = new THREE.Mesh(bhGeometry, bhMaterial);
            scene.add(blackHoleMesh);

            // Accretion Disk - Torus geometry
            if (accretionDisk) scene.remove(accretionDisk);
            const diskGeometry = new THREE.TorusGeometry(radius * 2.5, radius * 0.5, 2, 100);
            const diskMaterial = new THREE.MeshBasicMaterial({
                color: 0xff8800, // Fiery orange/red
                side: THREE.DoubleSide
            });
            accretionDisk = new THREE.Mesh(diskGeometry, diskMaterial);
            accretionDisk.rotation.x = Math.PI / 2; // Lay flat on the XZ plane
            scene.add(accretionDisk);
        }

        function createObject(distance) {
            // Object/Faller - Simple light cube
            if (objectMesh) scene.remove(objectMesh);
            const objGeometry = new THREE.BoxGeometry(2, 2, 2);
            const objMaterial = new THREE.MeshLambertMaterial({ color: 0x5050ff });
            objectMesh = new THREE.Mesh(objGeometry, objMaterial);
            objectMesh.position.set(distance, 0, 0); // Place object on X-axis
            scene.add(objectMesh);

            // Reference Line from Black Hole to Object
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0x333366 });
            const points = [];
            points.push(new THREE.Vector3(0, 0, 0));
            points.push(new THREE.Vector3(distance, 0, 0));
            const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
            objectMesh.line = new THREE.Line(lineGeometry, lineMaterial);
            scene.add(objectMesh.line);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update(); // only required if controls.enableDamping = true, or if controls.autoRotate = true
            accretionDisk.rotation.z += 0.005; // Make the disk spin
            renderer.render(scene, camera);
        }

        // --- 3. PHYSICS CALCULATIONS ---

        function formatSci(value, fixed=4) {
             // Use toFixed for smaller numbers, scientific notation for larger/smaller numbers
             if (Math.abs(value) > 1e6 || Math.abs(value) < 1e-4 && value !== 0) {
                 return value.toExponential(fixed);
             }
             return value.toFixed(fixed);
        }

        function runSimulation() {
            const M = parseFloat(document.getElementById('mass').value);
            const r = parseFloat(document.getElementById('distance').value);
            // New and renamed inputs
            const m = parseFloat(document.getElementById('objectMass').value);
            const refTime = parseFloat(document.getElementById('referenceTime').value);
            const refLength = parseFloat(document.getElementById('referenceLength').value);


            if (isNaN(M) || isNaN(r) || M <= 0 || r <= 0) {
                console.error("Invalid input for Mass or Distance.");
                return;
            }

            // 1. Schwarzschild Radius (r_s)
            const r_s = (2 * PHYSICS.G * M) / (PHYSICS.C * PHYSICS.C);

            // Validation check: Distance must be outside the event horizon
            if (r <= r_s) {
                document.getElementById('rs-result').textContent = formatSci(r_s, 3);
                document.getElementById('distance').classList.add('border-red-500');
                document.getElementById('rs-card').classList.add('bg-red-900/50');
                console.log("Warning: The object distance (r) is inside or at the Schwarzschild Radius (r <= r_s). Physics break down here.");
                return;
            } else {
                document.getElementById('distance').classList.remove('border-red-500');
                document.getElementById('rs-card').classList.remove('bg-red-900/50');
            }

            // --- Core Relativistic Factor ---
            // Dilation Factor (D) = sqrt(1 - r_s / r)
            const dilationFactor = Math.sqrt(1 - r_s / r);
            const inverseDilationFactor = 1 / dilationFactor;

            // --- CALCULATIONS ---

            // 2. Time Dilation (using the reference time)
            const t_faller = refTime * dilationFactor;
            const t_viewer = refTime * inverseDilationFactor;

            // 3. Length Compression (using the reference length)
            const L_faller = refLength * dilationFactor;
            const L_viewer_observed = refLength * inverseDilationFactor; // Length perceived by viewer when faller's proper length is refLength.
            // Note: The Python code's logic is inverted. A viewer observes a *contracted* length (L_faller) when measuring the object near the BH, not a stretched length.
            // The formula L_faller = L_viewer * DATION_FACTOR is for the length of an object (faller) near the BH as observed by the far-away viewer.
            // I will label L_faller as the length the far observer sees, and L_viewer as the proper length (the length the object measures).
            // Let's stick to the interpretation from the original Python logic:
            const fallersLength_Compressed = refLength * dilationFactor; // Viewer's length (L_viewer) is the proper length (refLength). Faller's perceived/measured length is fallersLength_Compressed.
            const viewersLength_Stretched = refLength / dilationFactor; // Faller's length (L_faller) is the proper length (refLength). Viewer's perceived length is viewersLength_Stretched.

            // 4. Escape Velocity
            const escapeVelocity = Math.sqrt((2 * PHYSICS.G * M) / r);

            // 5. Orbital Velocity
            const orbitalVelocity = Math.sqrt((PHYSICS.G * M) / r);

            // 6. Gravitational Redshift
            const gravitationalRedshift = inverseDilationFactor - 1;

            // 7. Gravitational Potential Energy
            const gravitationalPotentialEnergy = -((PHYSICS.G * m * M) / r);

            // 8. Acceleration required to hover (Proper Acceleration)
            const accelerationHover = (PHYSICS.G * M / (r * r)) * inverseDilationFactor;

            // 9. Orbital Period
            const orbitalPeriod = 2 * Math.PI * Math.sqrt((r * r * r) / (PHYSICS.G * M));

            // 10. Tidal Force (Using the Reference Length/Height)
            const tidalForce = (2 * PHYSICS.G * M * refLength) / (r * r * r);

            // --- 4. UPDATE UI RESULTS ---

            // General results
            document.getElementById('rs-result').textContent = formatSci(r_s, 3);
            document.getElementById('redshift-result').textContent = formatSci(gravitationalRedshift, 5);
            document.getElementById('hover-accel-result').textContent = formatSci(accelerationHover, 4);

            // Time Dilation
            document.getElementById('referenceTime-display').textContent = refTime.toFixed(1);
            document.getElementById('faller-time-result').textContent = t_faller.toFixed(5);
            document.getElementById('viewer-time-result').textContent = t_viewer.toFixed(5);

            // Length Compression
            document.getElementById('referenceLength-display').textContent = refLength.toFixed(3);
            document.getElementById('faller-length-result').textContent = fallersLength_Compressed.toFixed(5);
            document.getElementById('viewer-length-result').textContent = viewersLength_Stretched.toFixed(5);

            // Dynamics & Energy
            document.getElementById('pot-energy-result').textContent = formatSci(gravitationalPotentialEnergy, 4);
            document.getElementById('escape-vel-result').textContent = formatSci(escapeVelocity, 3);
            document.getElementById('orbital-vel-result').textContent = formatSci(orbitalVelocity, 3);
            document.getElementById('tidal-force-result').textContent = formatSci(tidalForce, 3);


            // --- 5. UPDATE 3D SCENE ---

            // Normalize r_s and r to a viewable scale
            const visualRs = r_s * SCALE_FACTOR;
            const visualR = r * SCALE_FACTOR;

            // Black Hole (R_s)
            const bhRadius = Math.max(1, visualRs); // Ensure min size of 1 for visibility
            blackHoleMesh.scale.set(bhRadius / blackHoleMesh.geometry.parameters.radius, bhRadius / blackHoleMesh.geometry.parameters.radius, bhRadius / blackHoleMesh.geometry.parameters.radius);

            // Accretion Disk (scale with BH)
            accretionDisk.scale.set(bhRadius / accretionDisk.geometry.parameters.innerRadius * 0.4, bhRadius / accretionDisk.geometry.parameters.innerRadius * 0.4, 1);
            accretionDisk.rotation.z += 0.01;

            // Object (r)
            const objectDistance = visualR;
            objectMesh.position.set(objectDistance, 0, 0);

            // Update Orbit/Reference Line
            scene.remove(objectMesh.line);
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0x333366 });
            const points = [];
            points.push(new THREE.Vector3(0, 0, 0));
            points.push(new THREE.Vector3(objectDistance, 0, 0));
            const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
            objectMesh.line = new THREE.Line(lineGeometry, lineMaterial);
            scene.add(objectMesh.line);

            // Adjust camera position if object moves far away
            if (objectDistance > 100) {
                camera.position.set(objectDistance * 0.5, objectDistance * 0.2, objectDistance * 0.8);
                controls.target.set(objectDistance * 0.5, 0, 0);
            } else {
                 camera.position.set(0, 50, 100);
                 controls.target.set(0, 0, 0);
            }
        }

        // Initialize Three.js on window load
        window.onload = function() {
            initThreeJS();
        }

    </script>
</body>
</html>
